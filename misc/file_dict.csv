type,name,stage_number,stage_name,s3_bucket,path_local,path_s3,athena_table,observation_unit,primary_key,description,notes
input,training,0,ingest,ccao-data-dvc-us-east-1,input/training_data.parquet,,,pin,"year, meta_pin",Sales data used to train the model,"Excludes any PINs with multiple cards, therefore unit of observation is PIN"
input,assessment,0,ingest,ccao-data-dvc-us-east-1,input/assessment_data.parquet,,,card,"year, meta_pin, meta_card_num",Universe of properties that need assessed values,"Card-level, rather than PIN-level"
input,complex_id,0,ingest,ccao-data-dvc-us-east-1,input/complex_id_data.parquet,,,pin,"year, meta_pin",Programmatically created townhome complex IDs,"Purpose is to assign townhomes in the same ""complex"" the same value. Only run as-needed i.e. as little as possible"
input,land_site_rate,0,ingest,ccao-data-dvc-us-east-1,input/land_site_rate_data.parquet,,,pin,"year, meta_pin",Site-specific flat land values provided by Valuations,Applies to class 210 and 295 properties only
input,land_nbhd_rate,0,ingest,ccao-data-dvc-us-east-1,input/land_nbhd_rate_data.parquet,,,nbhd,"year, meta_nbhd",Neighborhood-level land rates (per sqft) provided by Valuations,Applies to all properties (except those with a PIN-specific flat value)
input,condo_strata,0,ingest,ccao-data-dvc-us-east-1,input/condo_strata_data.parquet,,,nbhd,"year, meta_pin",Condominium building strata cuts (ntile) or centers (k-means),Strata definitions by grouping variable. Each strata is a quantile boundary or k-means center recorded in log10 mean sale price of the condo building
input,hie,0,ingest,ccao-data-dvc-us-east-1,input/hie_data.parquet,,,pin,"year, pin","HIE data used to build training and assessment data, used for report generation",A complete retrieval of ccao.hie
input,char,0,ingest,ccao-data-dvc-us-east-1,input/char_data.parquet,,,card,"year, pin, card",Two years of characteristics data for the entire residential assessment set for report generation,Contains data for modeling year and one year prior
output,parameter_search,1,train,ccao-model-results-us-east-1,output/parameter_search/model_parameter_search.parquet,parameter_search/year={year}/{run_id}.parquet,parameter_search,model cv fold,"year, run_id, configuration, fold_id",Tidymodels tuning output from cross-validation,Each row is the result from one fold assessment from one iteration
output,parameter_raw,1,train,ccao-model-results-us-east-1,output/parameter_search/model_parameter_search.parquet,parameter_raw/year={year}/{run_id}.parquet,,model cv fold,"year, run_id, configuration, fold_id","Raw, nested Tidymodels tuning output",Not useful in Athena but needed to make models reproducible
output,parameter_final,1,train,ccao-model-results-us-east-1,output/parameter_final/model_parameter_final.parquet,parameter_final/year={year}/{run_id}.parquet,parameter_final,model run,"year, run_id",Chosen set of hyperparameters for each run,"As chosen by tune::select_best() if using CV, otherwise the default set of hyperparameters specified in params.yaml (model.hyperparameter.default)"
output,parameter_range,1,train,ccao-model-results-us-east-1,output/parameter_range/model_parameter_range.parquet,parameter_range/year={year}/{run_id}.parquet,parameter_range,parameter,"year, run_id, parameter_name",Range of hyperparameters searched during CV tuning,As specified in params.yaml (model.hyperparameter.range)
output,test_card,1,train,ccao-model-results-us-east-1,output/test_card/model_test_card.parquet,test_card/year={year}/{run_id}.parquet,test_card,card,"year, meta_pin, meta_card_num",Test set predictions at the card level,Only includes the minimal variables necessary to perform evaluation
output,workflow_fit,1,train,ccao-model-results-us-east-1,output/workflow/fit/model_workflow_fit.zip,workflow/fit/year={year}/{run_id}.zip,,model run,,Trained LightGBM model object + Tidymodels specification,Can be loaded with lightsnip::lgbm_load() to produce predictions using new data
output,workflow_recipe,1,train,ccao-model-results-us-east-1,output/workflow/recipe/model_workflow_recipe.rds,workflow/recipe/year={year}/{run_id}.rds,,model run,,Trained Tidymodels recipe object used for data preprocessing,Can be used to prepare new data in the same way as the original model training
output,assessment_card,2,assess,ccao-model-results-us-east-1,output/assessment_card/model_assessment_card.parquet,assessment_card/,assessment_card,card,"year, run_id, township_code, meta_pin, meta_card_num",Assessment results at the card level AKA raw model output,Also includes card-level characteristics. Multi-card PINs will have more than one row. NOTE: Each run adds new partitions to S3 which must be added via a Glue crawler
output,assessment_pin,2,assess,ccao-model-results-us-east-1,output/assessment_pin/model_assessment_pin.parquet,assessment_pin/,assessment_pin,pin,"year, run_id, township_code, meta_pin",Assessment results at the PIN level AKA aggregated and cleaned,"Aggregation depends on PIN specifics, see assess script for details. Includes PIN-level stats like YoY % changes, land, sales, etc. NOTE: Each run adds new partitions to S3 which must be added via a Glue crawler"
output,performance_test,3,evaluate,ccao-model-results-us-east-1,output/performance/model_performance_test.parquet,performance/year={year}/stage=test/{run_id}.parquet,performance,geography [by class],"year, run_id, stage, geography_type, geography_id, by_class, class",Peformance metrics (optionally) broken out by class for different levels of geography,Test set includes the most recent 10% of sales
output,performance_test_linear,3,evaluate,ccao-model-results-us-east-1,output/performance/model_performance_test_linear.parquet,performance/year={year}/stage=test_linear/{run_id}.parquet,performance,geography [by class],"year, run_id, stage, geography_type, geography_id, by_class, class",Peformance metrics (optionally) broken out by class for different levels of geography,Test set performance stats using a linear baseline model
output,performance_assessment,3,evaluate,ccao-model-results-us-east-1,output/performance/model_performance_assessment.parquet,performance/year={year}/stage=assessment/{run_id}.parquet,performance,geography [by class],"year, run_id, stage, geography_type, geography_id, by_class, class",Peformance metrics (optionally) broken out by class for different levels of geography,Assessment set uses the prior year sales to compare to the assessed value
output,performance_quantile_test,3,evaluate,ccao-model-results-us-east-1,output/performance_quantile/model_performance_quantile_test.parquet,performance_quantile/year={year}/stage=test/{run_id}.parquet,performance_quantile,geography [by class] by quantile,"year, run_id, stage, geography_type, geography_id, by_class, class, quantile",Performance metrics by quantile within class and geography,Test set includes the most recent 10% of sales
output,performance_quantile_test_linear,3,evaluate,ccao-model-results-us-east-1,output/performance_quantile/model_performance_quantile_test_linear.parquet,performance_quantile/year={year}/stage=test_linear/{run_id}.parquet,performance_quantile,geography [by class] by quantile,"year, run_id, stage, geography_type, geography_id, by_class, class, quantile",Performance metrics by quantile within class and geography,Test set performance stats using a linear baseline model
output,performance_quantile_assessment,3,evaluate,ccao-model-results-us-east-1,output/performance_quantile/model_performance_quantile_assessment.parquet,performance_quantile/year={year}/stage=assessment/{run_id}.parquet,performance_quantile,geography [by class] by quantile,"year, run_id, stage, geography_type, geography_id, by_class, class, quantile",Performance metrics by quantile within class and geography,Assessment set uses the prior year sales to compare to the assessed value
output,shap,4,interpret,ccao-model-results-us-east-1,output/shap/model_shap.parquet,shap/,shap,card,"year, run_id, township_code, meta_pin, meta_card_num",SHAP values for each feature for each card in the assessment data,NOTE: Each run adds new partitions to S3 which must be added via a Glue crawler
output,feature_importance,4,interpret,ccao-model-results-us-east-1,output/feature_importance/model_feature_importance.parquet,feature_importance/year={year}/{run_id}.parquet,feature_importance,predictor,"year, run_id, model_predictor_all_name","Feature importance values (gain, cover, and frequency) for the run",
output,report_performance,5,finalize,ccao-model-results-us-east-1,reports/performance/performance.html,report/year={year}/report_type=performance/{run_id}.html,,model run,,Rendered Quarto doc with model performance statistics,
output,metadata,5,finalize,ccao-model-results-us-east-1,output/metadata/model_metadata.parquet,metadata/year={year}/{run_id}.parquet,metadata,model run,"year, run_id","Information about each run, including parameters, run ID, git info, etc.",
intermediate,timing,,all,,output/intermediate/timing/,,,model stage,"year, msg",Parquet files for each stage containing the stage time elapsed,Converted into a one-row data frame in the finalize stage
output,timing,,all,ccao-model-results-us-east-1,output/timing/model_timing.parquet,timing/year={year}/{run_id}.parquet,timing,model run,"year, run_id",Finalized time elapsed for each stage of the run,"Each row represents one run, while columns represent the stages"
